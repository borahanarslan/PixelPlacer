function createBackGroundCanvas(n,t,i){isGreenScreen=t;ProjectVideoId=i;backVideo=document.createElement("video");backVideo.addEventListener("loadedmetadata",OnMetaData);backVideo.src=n;backVideo.width=640;backVideo.height=360;backVideo.loop=!0;backVideo.pause()}function OnMetaData(n){var u,i,t,e,o;backgroundParent=document.getElementById("vid-1");u=backgroundParent.getBoundingClientRect().width;console.log("container size",u);var s=n.target.videoWidth,h=n.target.videoHeight,c=u/s;if(n.target.width=u,n.target.height=h*c,isGreenScreen==2){t=document.createElement("canvas");t.id="background-video";t.width=n.target.width;t.height=n.target.height;t.style.verticalAlign="bottom";var r=new Seriously,l=r.source(backVideo),a=r.target(t),f=r.effect("chroma");f.source=l;i=r.transform("reformat");i.width=t.width;i.height=t.height;i.mode="distort";i.source=f;a.source=i;f.screen=[98/255,175/255,116/255,1];backgroundParent.appendChild(t);r.go();backVideo.play()}else t=document.createElement("canvas"),t.id="background-video",t.width=n.target.width,t.height=n.target.height,t.style.verticalAlign="bottom",e=t.getContext("2d"),backgroundParent.appendChild(t),backVideo.addEventListener("play",function(){var i=this;(function n(){this.paused||this.ended||(e.drawImage(backVideo,0,0,t.width,t.height),setTimeout(n,1e3/30))})()}),backVideo.play();o={XPosition:0,YPosition:0,Width:t.width,Height:t.height,Rotation:0,ProjectVideosId:ProjectVideoId};ProjectObject.ProjectClass.push(o)}function createCanvas(n,t){var i=document.createElement("video"),r,u;i.id="video-"+n;i.src=t;i.width=250;i.height=150;i.loop=!0;r=document.createElement("canvas");r.width=i.width;r.height=i.height;r.id="c-"+n;r.draggable=!0;r.ondragstart=drag;var f=new Seriously,o=f.source(i),s=f.target(r),e=f.effect("chroma");e.source=o;u=f.transform("reformat");u.width=250;u.height=150;u.mode="distort";u.source=e;s.source=u;e.screen=[98/255,175/255,116/255,1];document.getElementById(n).appendChild(r);f.go();i.play()}function allowDrop(n){n.preventDefault()}function drag(n){var t=n.target.getBoundingClientRect();xPos=n.clientX-t.left-window.scrollX;yPos=n.clientY-t.top-window.scrollY;n.dataTransfer.setData("text",n.target.id)}function drop(n){var e,t,u,f,r,i,c;n.preventDefault();e=n.dataTransfer.getData("text");t=document.getElementById(e);n.target.parentElement.appendChild(t);var o=document.getElementById("background-video"),s=n.clientX-o.getBoundingClientRect().left-window.scrollX,h=n.clientY-o.getBoundingClientRect().top-window.scrollY;for(t.style.position="absolute",t.style.left=s-xPos+"px",t.style.top=h-yPos+"px",canvasX=Math.floor(s-xPos),canvasY=Math.floor(h-yPos),u=t.id.replace("c-canvas-",""),f=!1,r=0;r<ProjectObject.ProjectClass.length;r++)i=ProjectObject.ProjectClass[r],i.ProjectVideosId==u&&(i.XPosition=canvasX,i.YPosition=canvasY,i.Width=t.width,i.Height=t.height,i.Rotation=t.style.rotation,f=!0);f==!1&&(c={XPosition:canvasX,YPosition:canvasY,Width:t.width,Height:t.height,Rotation:t.style.rotation,ProjectVideosId:u},$(t).mouseup(TransformMouseUp),ProjectObject.ProjectClass.push(c));t.draggable=!1;$(t).addClass("trans");$(t).freetrans({x:canvasX,y:canvasY-backVideo.height,"rot-origin":"0 0"}).css({border:"1px solid #CCCCCC"});$("#"+t.id).freetrans({"rot-origin":"50% 50%"});$(t).mouseup("mouseup",MouseUp)}function TransformMouseUp(){var r,t,e;console.log("is this event happening?");var i=event.target,n=$(i).freetrans("getBounds"),u=i.id.replace("c-canvas-",""),f=!1;for(r=0;r<ProjectObject.ProjectClass.length;r++)t=ProjectObject.ProjectClass[r],t.ProjectVideosId==u&&(t.XPosition=n.xmin,t.YPosition=n.ymin,t.Width=n.width,t.Height=n.height-backVideo.height,t.Rotation=i.style.rotation,f=!0);f==!1&&(e={XPosition:n.xmin,YPosition:n.ymin,Width:n.width,Height:n.height-backVideo.height,Rotation:i.style.rotation,ProjectVideosId:u},ProjectObject.ProjectClass.push(e))}var xPos,yPos,canvasX,canvasY,backgroundParent,ProjectObject={},isGreenScreen,Xposition,Yposition,ProjectVideoId,backVideo;ProjectObject.ProjectClass=[];$(document).ready(function(){$("#SaveButton").click(function(){var n=document.getElementById("ProjectTitle").value;ProjectObject.Title=n;$.ajax({url:"/Projects/SaveProject",type:"post",dataType:"json",data:ProjectObject,success:function(n){console.log("I'm awesome",n);window.location.href="/Home/Profile"}})})});